<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lock Calendar Protocol - Master AI</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (for JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        /* Custom Animations needed for the UI */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }
        .animate-slide-up {
            animation: slideUp 0.6s ease-out forwards;
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1c1917; 
        }
        ::-webkit-scrollbar-thumb {
            background: #44403c; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #57534e; 
        }
    </style>
</head>
<body class="bg-stone-950 text-stone-200">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICON COMPONENTS (Manually defined for CDN compatibility) ---
        const IconBase = ({ d, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {d}
            </svg>
        );

        const Lock = (props) => <IconBase {...props} d={<><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></>} />;
        const Key = (props) => <IconBase {...props} d={<><path d="m21 2-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0 3 3L22 7l-3-3m-3.5 3.5L19 4"></path></>} />;
        const CalendarIcon = (props) => <IconBase {...props} d={<><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></>} />;
        const ShieldAlert = (props) => <IconBase {...props} d={<><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></>} />;
        const CheckCircle = (props) => <IconBase {...props} d={<><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></>} />;
        const RefreshCcw = (props) => <IconBase {...props} d={<><path d="M3 2v6h6"></path><path d="M21 12A9 9 0 0 0 6 5.3L3 8"></path><path d="M21 22v-6h-6"></path><path d="M3 12a9 9 0 0 0 15 6.7l3-2.7"></path></>} />;
        const XIcon = (props) => <IconBase {...props} d={<><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></>} />;
        const Activity = (props) => <IconBase {...props} d={<><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></>} />;
        const Thermometer = (props) => <IconBase {...props} d={<><path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z"></path></>} />;
        const ChevronRight = (props) => <IconBase {...props} d={<><polyline points="9 18 15 12 9 6"></polyline></>} />;
        const Download = (props) => <IconBase {...props} d={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></>} />;
        const Eye = (props) => <IconBase {...props} d={<><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></>} />;
        const Zap = (props) => <IconBase {...props} d={<><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></>} />;
        const Disc = (props) => <IconBase {...props} d={<><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="3"></circle></>} />;
        const Palette = (props) => <IconBase {...props} d={<><circle cx="13.5" cy="6.5" r=".5"></circle><circle cx="17.5" cy="10.5" r=".5"></circle><circle cx="8.5" cy="7.5" r=".5"></circle><circle cx="6.5" cy="12.5" r=".5"></circle><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"></path></>} />;
        const Droplet = (props) => <IconBase {...props} d={<><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path></>} />;
        const Ghost = (props) => <IconBase {...props} d={<><path d="M9 22l1-2.5 2 2.5 2-2.5 2 2.5 1-2.5V9a7 7 0 0 0-7-7 7 7 0 0 0-7 7v10.5L9 22z"></path><path d="M9 9h.01"></path><path d="M15 9h.01"></path></>} />;
        const Flame = (props) => <IconBase {...props} d={<><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></>} />;
        const Anchor = (props) => <IconBase {...props} d={<><circle cx="12" cy="5" r="3"></circle><line x1="12" y1="22" x2="12" y2="8"></line><path d="M5 12H2a10 10 0 0 0 20 0h-3"></path></>} />;
        const Globe = (props) => <IconBase {...props} d={<><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></>} />;
        const Ruler = (props) => <IconBase {...props} d={<><path d="M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0l12.6 12.6z"></path><line x1="14.5" y1="5.5" x2="18.5" y2="9.5"></line><line x1="10.5" y1="9.5" x2="14.5" y2="13.5"></line><line x1="6.5" y1="13.5" x2="10.5" y2="17.5"></line></>} />;
        const Smile = (props) => <IconBase {...props} d={<><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></>} />;
        const Headphones = (props) => <IconBase {...props} d={<><path d="M3 18v-6a9 9 0 0 1 18 0v6"></path><path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path></>} />;
        
        // --- TRANSLATIONS ---
        const TRANSLATIONS = {
          'zh-TW': {
            title: 'é–æ›†è¨ˆç•«', subtitle: 'PROTOCOL', version: 'MASTER AI v5.0',
            intro_title: 'æ­¡è¿ä¾†åˆ°ä½ çš„æ–°ç”Ÿæ´»',
            intro_desc: (accent) => <span>æˆ‘æ˜¯ç³»çµ±æŒ‡å°è€…ã€‚ä½ æ¸´æœ›<span className={accent}>æ§åˆ¶</span>èˆ‡<span className={accent}>å‰å¥ª</span>ã€‚åœ¨é€™è£¡ï¼Œä½ ä¸éœ€è¦æ€è€ƒï¼Œåªéœ€è¦<span className="font-bold">åŸ·è¡Œ</span>ã€‚</span>,
            btn_start: 'é–‹å§‹åˆ¶å®šè¨ˆç•«', step1_title: 'åŸºæœ¬è³‡æ–™', label_name: 'æš±ç¨± / ç¨±å‘¼ Â· Nickname', label_level: 'å¼·åº¦ç­‰ç´š Â· Intensity',
            label_date: 'è£½ä½œæœˆä»½ Â· Date', label_year: 'è¥¿å…ƒå¹´ Â· YYYY', label_month: 'æœˆä»½ Â· Month',
            step1_ratings_title: 'éƒ¨ä½èˆ‡ç¨‹åº¦æ¥å—åº¦ Â· Zones & Limits',
            label_nipples: 'ä¹³é ­é–‹ç™¼ Â· Nipples', label_anal: 'å¾Œåº­é©æ‡‰ Â· Anal', label_urethra: 'å°¿é“/æ’æ³„ Â· Urethra',
            label_pain: 'ç–¼ç—›å¿å— Â· Pain', label_humiliation: 'ç¾æ¥æ„Ÿ Â· Humiliation', label_edging: 'é‚Šç·£æ§å°„ Â· Edging',
            label_bondage: 'æŸç¸›/æ‹˜æŸ Â· Bondage', label_public: 'éœ²å‡º/é‡å¤– Â· Public', label_service: 'ä¾å¥‰/ä»»å‹™ Â· Service',
            label_sensory: 'æ„Ÿå®˜å‰å¥ª Â· Sensory',
            step1_theme_title: 'è¦–è¦ºä¸»é¡Œé¢¨æ ¼ Â· Visual Theme', btn_generate: 'ç”Ÿæˆé–æ›†è¨ˆç•« Â· Generate Protocol',
            step2_title: 'çš„å°ˆå±¬é–æ›†', btn_reset: 'é‡æ–°è©•ä¼°', btn_download: 'ä¸‹è¼‰é–æ›†', modal_day: 'DAY',
            footer_sign: 'I hereby surrender my control.\nSignature: __________________________', footer_approve: 'MASTER APPROVED',
            warn_title: 'è­¦å‘Šï¼šæˆäººå…§å®¹', warn_text1: 'æœ¬ç¶²ç«™å…§å®¹æ¶µè“‹æˆäººè­°é¡Œã€BDSM ä»¥åŠè²æ“æ§åˆ¶ç­‰æƒ…ç¯€ã€‚', warn_text2: 'ä¾æ“šã€Šå…’ç«¥åŠå°‘å¹´ç¦åˆ©èˆ‡æ¬Šç›Šä¿éšœæ³•ã€‹ç¬¬ 46 æ¢è¦å®šï¼Œæœªæ»¿ 18 æ­²ä¹‹å…’ç«¥åŠå°‘å¹´ä¸å¾—ç€è¦½æœ¬ç¶²ç«™å…§å®¹ã€‚', warn_leave: 'é›¢é–‹ (Leave)', warn_enter: 'æˆ‘å·²å¹´æ»¿ 18 æ­² (Enter)'
          },
          'en': {
            title: 'LOCK PROTOCOL', subtitle: 'SYSTEM', version: 'MASTER AI v5.0',
            intro_title: 'Welcome to Your New Life',
            intro_desc: (accent) => <span>I am the System Master. You crave <span className={accent}>Control</span> and <span className={accent}>Denial</span>. Here, you don't think. You <span className="font-bold">Obey</span>.</span>,
            btn_start: 'Initialize Protocol', step1_title: 'Subject Data', label_name: 'Name Â· Callsign', label_level: 'Intensity Â· Level',
            label_date: 'Target Date Â· Month', label_year: 'Year Â· YYYY', label_month: 'Month Â· MM',
            step1_ratings_title: 'Zones & Limits',
            label_nipples: 'Nipples', label_anal: 'Anal', label_urethra: 'Urethra/Piss', label_pain: 'Pain Tolerance',
            label_humiliation: 'Humiliation', label_edging: 'Edging/Denial', label_bondage: 'Bondage', label_public: 'Public/Exposure',
            label_service: 'Service/Chores', label_sensory: 'Sensory Deprivation',
            step1_theme_title: 'Visual Theme', btn_generate: 'Generate Protocol', step2_title: "'s Lock Calendar", btn_reset: 'Reset', btn_download: 'Download',
            modal_day: 'DAY', footer_sign: 'I hereby surrender my control.\nSignature: __________________________', footer_approve: 'MASTER APPROVED',
            warn_title: 'WARNING: ADULT CONTENT', warn_text1: 'This site contains adult themes including BDSM and Chastity.', warn_text2: 'You must be 18 years or older to enter.', warn_leave: 'Leave', warn_enter: 'I am 18+ (Enter)'
          },
          'jp': {
            title: 'è²æ“ç®¡ç†è¨ˆç”»', subtitle: 'PROTOCOL', version: 'MASTER AI v5.0',
            intro_title: 'æ–°ã—ã„ç”Ÿæ´»ã¸ã‚ˆã†ã“ã',
            intro_desc: (accent) => <span>ç§ã¯ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ã§ã™ã€‚ã‚ãªãŸã¯<span className={accent}>æ”¯é…</span>ã¨<span className={accent}>å‰¥å¥ª</span>ã‚’æœ›ã‚“ã§ã„ã¾ã™ã€‚ã“ã“ã§ã¯è€ƒãˆã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<span className="font-bold">å®Ÿè¡Œ</span>ã‚ã‚‹ã®ã¿ã§ã™ã€‚</span>,
            btn_start: 'è¨ˆç”»ã‚’ä½œæˆã™ã‚‹', step1_title: 'åŸºæœ¬ãƒ‡ãƒ¼ã‚¿', label_name: 'åå‰ Â· Nickname', label_level: 'å¼·åº¦ Â· Intensity',
            label_date: 'æ—¥ä»˜è¨­å®š Â· Date', label_year: 'è¥¿æš¦ Â· YYYY', label_month: 'æœˆ Â· Month',
            step1_ratings_title: 'éƒ¨ä½ã¨ãƒ¬ãƒ™ãƒ« Â· Zones & Limits',
            label_nipples: 'ä¹³é¦–é–‹ç™º Â· Nipples', label_anal: 'ã‚¢ãƒŠãƒ«é–‹ç™º Â· Anal', label_urethra: 'å°¿é“/æ’æ³„ Â· Urethra',
            label_pain: 'è‹¦ç—›è€æ€§ Â· Pain', label_humiliation: 'ç¾æ¥å¿ƒ Â· Humiliation', label_edging: 'å¯¸æ­¢ã‚ Â· Edging',
            label_bondage: 'æ‹˜æŸ Â· Bondage', label_public: 'éœ²å‡º/é‡å¤– Â· Public', label_service: 'å¥‰ä»• Â· Service', label_sensory: 'æ„Ÿè¦šé®æ–­ Â· Sensory',
            step1_theme_title: 'ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ Â· Theme', btn_generate: 'è¨ˆç”»ã‚’ç”Ÿæˆ Â· Generate', step2_title: 'ã®ç®¡ç†ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼', btn_reset: 'å†è¨­å®š', btn_download: 'ç”»åƒã‚’ä¿å­˜',
            modal_day: 'DAY', footer_sign: 'I hereby surrender my control.\nSignature: __________________________', footer_approve: 'MASTER APPROVED',
            warn_title: 'R-18 æˆäººå‘ã‘', warn_text1: 'ã“ã®ã‚µã‚¤ãƒˆã«ã¯BDSMã‚„è²æ“å¸¯ãªã©ã®æˆäººå‘ã‘ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚', warn_text2: '18æ­³æœªæº€ã®æ–¹ã®é–²è¦§ã¯å›ºããŠæ–­ã‚Šã—ã¾ã™ã€‚', warn_leave: 'é€€å‡ºã™ã‚‹', warn_enter: '18æ­³ä»¥ä¸Šã§ã™ (Enter)'
          },
          'kr': {
            title: 'ì •ì¡° ê´€ë¦¬ ê³„íš', subtitle: 'PROTOCOL', version: 'MASTER AI v5.0',
            intro_title: 'ìƒˆë¡œìš´ ì‚¶ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤',
            intro_desc: (accent) => <span>ì‹œìŠ¤í…œ ê´€ë¦¬ìì…ë‹ˆë‹¤. ë‹¹ì‹ ì€ <span className={accent}>í†µì œ</span>ì™€ <span className={accent}>ë°•íƒˆ</span>ì„ ê°ˆë§í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ìƒê°í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤. <span className="font-bold">ë³µì¢…</span>í•˜ì‹­ì‹œì˜¤.</span>,
            btn_start: 'í”„ë¡œí† ì½œ ì‹œì‘', step1_title: 'ê¸°ë³¸ ì •ë³´', label_name: 'ì´ë¦„/í˜¸ì¹­ Â· Name', label_level: 'ê°•ë„ Â· Level',
            label_date: 'ë‚ ì§œ ì„¤ì • Â· Date', label_year: 'ì—°ë„ Â· YYYY', label_month: 'ì›” Â· Month',
            step1_ratings_title: 'ì˜ì—­ ë° í•œê³„ Â· Zones & Limits',
            label_nipples: 'ìœ ë‘ ê°œë°œ Â· Nipples', label_anal: 'ì• ë„ ì ì‘ Â· Anal', label_urethra: 'ìš”ë„/ë°°ì„¤ Â· Urethra', label_pain: 'ê³ í†µ ê°ë‚´ Â· Pain',
            label_humiliation: 'ìˆ˜ì¹˜ì‹¬ Â· Humiliation', label_edging: 'ì—ì§•/ì§€ì—° Â· Edging', label_bondage: 'ì†ë°•/êµ¬ì† Â· Bondage', label_public: 'ë…¸ì¶œ/ì•¼ì™¸ Â· Public',
            label_service: 'ë´‰ì‚¬/ì„ë¬´ Â· Service', label_sensory: 'ê°ê° ë°•íƒˆ Â· Sensory',
            step1_theme_title: 'ì‹œê° í…Œë§ˆ Â· Theme', btn_generate: 'ê³„íš ìƒì„± Â· Generate', step2_title: 'ì˜ ìº˜ë¦°ë”', btn_reset: 'ì¬ì„¤ì •', btn_download: 'ë‹¤ìš´ë¡œë“œ',
            modal_day: 'DAY', footer_sign: 'I hereby surrender my control.\nSignature: __________________________', footer_approve: 'MASTER APPROVED',
            warn_title: 'ì„±ì¸ ì½˜í…ì¸  ê²½ê³ ', warn_text1: 'ì´ ì‚¬ì´íŠ¸ëŠ” BDSM ë° ì •ì¡°ëŒ€ì™€ ê°™ì€ ì„±ì¸ ì£¼ì œë¥¼ í¬í•¨í•©ë‹ˆë‹¤.', warn_text2: '18ì„¸ ë¯¸ë§Œì€ ì…ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', warn_leave: 'ë‚˜ê°€ê¸°', warn_enter: '18ì„¸ ì´ìƒ (ì…ì¥)'
          },
          'de': {
            title: 'KEUSCHHEITS PROTOKOLL', subtitle: 'SYSTEM', version: 'MASTER AI v5.0',
            intro_title: 'Willkommen in deinem neuen Leben',
            intro_desc: (accent) => <span>Ich bin der System-Meister. Du sehnst dich nach <span className={accent}>Kontrolle</span> und <span className={accent}>Verweigerung</span>. Hier denkst du nicht. Du <span className="font-bold">Gehorchst</span>.</span>,
            btn_start: 'Protokoll Starten', step1_title: 'Subjekt Daten', label_name: 'Name Â· Callsign', label_level: 'IntensitÃ¤t Â· Level',
            label_date: 'Zieldatum Â· Date', label_year: 'Jahr Â· YYYY', label_month: 'Monat Â· Month',
            step1_ratings_title: 'Zonen & Limits',
            label_nipples: 'Nippel', label_anal: 'Anal', label_urethra: 'Urethra', label_pain: 'Schmerz',
            label_humiliation: 'Erniedrigung', label_edging: 'Edging', label_bondage: 'Fesselung', label_public: 'Ã–ffentlichkeit',
            label_service: 'Dienst', label_sensory: 'Sensorischer Entzug',
            step1_theme_title: 'Visuelles Thema', btn_generate: 'Generieren', step2_title: 's Kalender', btn_reset: 'ZurÃ¼cksetzen', btn_download: 'Herunterladen',
            modal_day: 'TAG', footer_sign: 'I hereby surrender my control.\nSignature: __________________________', footer_approve: 'MEISTER GENEHMIGT',
            warn_title: 'WARNUNG: INHALT AB 18', warn_text1: 'Diese Seite enthÃ¤lt Themen wie BDSM und Keuschheit.', warn_text2: 'Zugang nur fÃ¼r Erwachsene.', warn_leave: 'Verlassen', warn_enter: 'Eintreten (18+)'
          },
          'es': {
            title: 'PROTOCOLO DE CASTIDAD', subtitle: 'SISTEMA', version: 'MASTER AI v5.0',
            intro_title: 'Bienvenido a tu nueva vida',
            intro_desc: (accent) => <span>Soy el Maestro del Sistema. Anhelas <span className={accent}>Control</span> y <span className={accent}>NegaciÃ³n</span>. AquÃ­ no piensas. <span className="font-bold">Obedeces</span>.</span>,
            btn_start: 'Iniciar Protocolo', step1_title: 'Datos del Sujeto', label_name: 'Nombre Â· Apodo', label_level: 'Intensidad Â· Nivel',
            label_date: 'Fecha Objetivo Â· Date', label_year: 'AÃ±o Â· YYYY', label_month: 'Mes Â· Month',
            step1_ratings_title: 'Zonas y LÃ­mites',
            label_nipples: 'Pezones', label_anal: 'Anal', label_urethra: 'Uretra', label_pain: 'Dolor',
            label_humiliation: 'HumillaciÃ³n', label_edging: 'Edging', label_bondage: 'Bondage', label_public: 'PÃºblico',
            label_service: 'Servicio', label_sensory: 'PrivaciÃ³n Sensorial',
            step1_theme_title: 'Tema Visual', btn_generate: 'Generar Protocolo', step2_title: ' Calendario', btn_reset: 'Reiniciar', btn_download: 'Descargar',
            modal_day: 'DÃA', footer_sign: 'I hereby surrender my control.\nSignature: __________________________', footer_approve: 'APROBADO POR EL MAESTRO',
            warn_title: 'ADVERTENCIA: CONTENIDO ADULTO', warn_text1: 'Este sitio contiene temas de BDSM y Castidad.', warn_text2: 'Debes ser mayor de 18 aÃ±os.', warn_leave: 'Salir', warn_enter: 'Entrar (18+)'
          },
          'fr': {
            title: 'PROTOCOLE DE CHASTETÃ‰', subtitle: 'SYSTÃˆME', version: 'MASTER AI v5.0',
            intro_title: 'Bienvenue dans votre nouvelle vie',
            intro_desc: (accent) => <span>Je suis le MaÃ®tre du SystÃ¨me. Vous dÃ©sirez le <span className={accent}>ContrÃ´le</span> et le <span className={accent}>DÃ©ni</span>. Ici, vous ne pensez pas. Vous <span className="font-bold">ObÃ©issez</span>.</span>,
            btn_start: 'Lancer le Protocole', step1_title: 'DonnÃ©es du Sujet', label_name: 'Nom Â· Surnom', label_level: 'IntensitÃ© Â· Niveau',
            label_date: 'Date Cible Â· Date', label_year: 'AnnÃ©e Â· YYYY', label_month: 'Mois Â· Month',
            step1_ratings_title: 'Zones et Limites',
            label_nipples: 'Mamelons', label_anal: 'Anal', label_urethra: 'UrÃ¨tre', label_pain: 'Douleur',
            label_humiliation: 'Humiliation', label_edging: 'Edging', label_bondage: 'Bondage', label_public: 'Public',
            label_service: 'Service', label_sensory: 'Privation Sensorielle',
            step1_theme_title: 'ThÃ¨me Visuel', btn_generate: 'GÃ©nÃ©rer', step2_title: ' Calendrier', btn_reset: 'RÃ©initialiser', btn_download: 'TÃ©lÃ©charger',
            modal_day: 'JOUR', footer_sign: 'I hereby surrender my control.\nSignature: __________________________', footer_approve: 'APPROUVÃ‰ PAR LE MAÃTRE',
            warn_title: 'AVERTISSEMENT : CONTENU ADULTE', warn_text1: 'Ce site contient des thÃ¨mes BDSM.', warn_text2: 'AccÃ¨s rÃ©servÃ© aux majeurs.', warn_leave: 'Quitter', warn_enter: 'Entrer (18+)'
          },
          'ru': {
            title: 'ĞŸĞ ĞĞ¢ĞĞšĞĞ› Ğ’ĞĞ—Ğ”Ğ•Ğ Ğ–ĞĞĞ˜Ğ¯', subtitle: 'Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ', version: 'MASTER AI v5.0',
            intro_title: 'Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² Ğ½Ğ¾Ğ²ÑƒÑ Ğ¶Ğ¸Ğ·Ğ½ÑŒ',
            intro_desc: (accent) => <span>Ğ¯ Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¹ ĞœĞ°ÑÑ‚ĞµÑ€. Ğ¢Ñ‹ Ğ¶Ğ°Ğ¶Ğ´ĞµÑˆÑŒ <span className={accent}>ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ñ</span> Ğ¸ <span className={accent}>ĞÑ‚Ñ€Ğ¸Ñ†Ğ°Ğ½Ğ¸Ñ</span>. Ğ—Ğ´ĞµÑÑŒ Ñ‚Ñ‹ Ğ½Ğµ Ğ´ÑƒĞ¼Ğ°ĞµÑˆÑŒ. Ğ¢Ñ‹ <span className="font-bold">ĞŸĞ¾Ğ²Ğ¸Ğ½ÑƒĞµÑˆÑŒÑÑ</span>.</span>,
            btn_start: 'ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ ĞŸÑ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»', step1_title: 'Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¡ÑƒĞ±ÑŠĞµĞºÑ‚Ğ°', label_name: 'Ğ˜Ğ¼Ñ Â· ĞĞ¸Ğº', label_level: 'Ğ˜Ğ½Ñ‚ĞµĞ½ÑĞ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Â· Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ',
            label_date: 'Ğ”Ğ°Ñ‚Ğ° Â· Date', label_year: 'Ğ“Ğ¾Ğ´ Â· YYYY', label_month: 'ĞœĞµÑÑÑ† Â· Month',
            step1_ratings_title: 'Ğ—Ğ¾Ğ½Ñ‹ Ğ¸ ĞŸÑ€ĞµĞ´ĞµĞ»Ñ‹',
            label_nipples: 'Ğ¡Ğ¾ÑĞºĞ¸', label_anal: 'ĞĞ½Ğ°Ğ»', label_urethra: 'Ğ£Ñ€ĞµÑ‚Ñ€Ğ°', label_pain: 'Ğ‘Ğ¾Ğ»ÑŒ',
            label_humiliation: 'Ğ£Ğ½Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ', label_edging: 'Ğ­Ğ´Ğ¶Ğ¸Ğ½Ğ³', label_bondage: 'Ğ‘Ğ¾Ğ½Ğ´Ğ°Ğ¶', label_public: 'ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ğ¾',
            label_service: 'Ğ¡Ğ»ÑƒĞ¶ĞµĞ½Ğ¸Ğµ', label_sensory: 'Ğ¡ĞµĞ½ÑĞ¾Ñ€Ğ½Ğ°Ñ Ğ”ĞµĞ¿Ñ€Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ',
            step1_theme_title: 'Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¢ĞµĞ¼Ğ°', btn_generate: 'Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ', step2_title: ' ĞšĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ', btn_reset: 'Ğ¡Ğ±Ñ€Ğ¾Ñ', btn_download: 'Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ',
            modal_day: 'Ğ”Ğ•ĞĞ¬', footer_sign: 'I hereby surrender my control.\nSignature: __________________________', footer_approve: 'ĞĞ”ĞĞ‘Ğ Ğ•ĞĞ ĞœĞĞ¡Ğ¢Ğ•Ğ ĞĞœ',
            warn_title: 'Ğ’ĞĞ˜ĞœĞĞĞ˜Ğ•: 18+', warn_text1: 'Ğ¡Ğ°Ğ¹Ñ‚ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ Ñ‚ĞµĞ¼Ñ‹ BDSM.', warn_text2: 'Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ ÑĞ¾Ğ²ĞµÑ€ÑˆĞµĞ½Ğ½Ğ¾Ğ»ĞµÑ‚Ğ½Ğ¸Ñ….', warn_leave: 'Ğ’Ñ‹Ğ¹Ñ‚Ğ¸', warn_enter: 'Ğ’Ğ¾Ğ¹Ñ‚Ğ¸ (18+)'
          }
        };

        // --- TASKS DB ---
        const TASKS_DB = [
          // General
          { 
            tags: ["general"], intensity: "soft",
            text_zh: "å…¨å¤©ä½©æˆ´ï¼šä»Šå¤©åªéœ€ç¿’æ…£å®ƒçš„å­˜åœ¨ï¼Œæ„Ÿå—å®ƒçš„é‡é‡ã€‚",
            text_en: "24h Wear: Just get used to its existence and feel the weight.",
            text_jp: "çµ‚æ—¥ç€ç”¨ï¼šä»Šæ—¥ã¯ãã®å­˜åœ¨ã«æ…£ã‚Œã€é‡ã¿ã‚’æ„Ÿã˜ã‚‹ã ã‘ã§ã„ã„ã€‚",
            text_kr: "24ì‹œê°„ ì°©ìš©: ì¡´ì¬ì— ìµìˆ™í•´ì§€ê³  ë¬´ê²Œë¥¼ ëŠê»´ë³´ì„¸ìš”."
          },
          { 
            tags: ["general", "pain"], intensity: "soft",
            text_zh: "å†·æ°´æ¾¡ï¼šä½©æˆ´è‘—é–é€²è¡Œ 5 åˆ†é˜å†·æ°´æ·‹æµ´ï¼Œä¿æŒå†·éœã€‚",
            text_en: "Cold Shower: Take a 5-min cold shower while locked. Stay calm.",
            text_jp: "å†·æ°´ã‚·ãƒ£ãƒ¯ãƒ¼ï¼šãƒ­ãƒƒã‚¯ã—ãŸã¾ã¾5åˆ†é–“ã®å†·æ°´ã‚·ãƒ£ãƒ¯ãƒ¼ã‚’æµ´ã³ã‚‹ã€‚",
            text_kr: "ëƒ‰ìˆ˜ ìƒ¤ì›Œ: ì°©ìš©í•œ ì±„ë¡œ 5ë¶„ê°„ ëƒ‰ìˆ˜ ìƒ¤ì›Œë¥¼ í•˜ì„¸ìš”. í‰ì •ì‹¬ì„ ìœ ì§€í•˜ì„¸ìš”."
          },
          { 
            tags: ["general", "mind"], intensity: "soft",
            text_zh: "æ—©å®‰å„€å¼ï¼šèµ·åºŠå¾Œç«‹åˆ»æª¢æŸ¥é–å…·ï¼Œå°é¡å­èªªã€æˆ‘æ˜¯é–çš„å¥´éš¸ã€ã€‚",
            text_en: "Morning Ritual: Check the lock immediately and tell the mirror: 'I am a slave to the lock.'",
            text_jp: "æœã®å„€å¼ï¼šèµ·åºŠå¾Œã™ãã«ãƒ­ãƒƒã‚¯ã‚’ç¢ºèªã—ã€é¡ã«å‘ã‹ã£ã¦ã€Œç§ã¯éµã®å¥´éš·ã§ã™ã€ã¨è¨€ã†ã€‚",
            text_kr: "ì•„ì¹¨ ì˜ì‹: ì¼ì–´ë‚˜ìë§ˆì ìë¬¼ì‡ ë¥¼ í™•ì¸í•˜ê³  ê±°ìš¸ì„ ë³´ë©° ë§í•˜ì„¸ìš”: 'ë‚˜ëŠ” ìë¬¼ì‡ ì˜ ë…¸ì˜ˆì…ë‹ˆë‹¤.'"
          },
          { 
            tags: ["general"], intensity: "medium",
            text_zh: "ç¡çœ è¨“ç·´ï¼šä»Šæ™šå¿…é ˆä½©æˆ´è‘—å…¥ç¡ï¼Œä¸å…è¨±åŠå¤œå·å·è§£é–‹ã€‚",
            text_en: "Sleep Training: Must sleep locked tonight. No unlocking allowed.",
            text_jp: "ç¡çœ è¨“ç·´ï¼šä»Šå¤œã¯ãƒ­ãƒƒã‚¯ã—ãŸã¾ã¾çœ ã‚‹ã“ã¨ã€‚å¤œä¸­ã«å¤–ã™ã“ã¨ã¯è¨±ã•ã‚Œãªã„ã€‚",
            text_kr: "ìˆ˜ë©´ í›ˆë ¨: ì˜¤ëŠ˜ ë°¤ì€ ì°©ìš©í•œ ì±„ë¡œ ìì•¼ í•©ë‹ˆë‹¤. í•´ì œëŠ” í—ˆìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
          },

          // Edging
          { 
            tags: ["edging"], intensity: "medium",
            text_zh: "é‚Šç·£æ§åˆ¶ï¼šè§£é– 15 åˆ†é˜ï¼Œåªèƒ½ Edge 3 æ¬¡ï¼Œåš´ç¦ç™¼å°„ï¼Œé‡æ–°ä¸Šé–ã€‚",
            text_en: "Edge Control: Unlock for 15 mins, Edge 3 times only. NO release. Relock.",
            text_jp: "å¯¸æ­¢ã‚ç®¡ç†ï¼š15åˆ†é–“è§£éŒ ã€‚3å›å¯¸æ­¢ã‚ã‚’è¡Œã†ã€‚å°„ç²¾å³ç¦ã€‚å†æ–½éŒ ã€‚"
          },
          { 
            tags: ["edging"], intensity: "hard",
            text_zh: "å¯¸æ­¢åœ°ç„ï¼šè§€çœ‹ 20 åˆ†é˜å½±ç‰‡ä¸¦è‡ªæ…°ï¼Œåœ¨å¿«é«˜æ½®å‰ 1 ç§’åœæ‰‹ä¸¦ç«‹åˆ»ä¸Šé–ã€‚",
            text_en: "Edging Hell: Watch porn for 20 mins, stop 1 sec before orgasm and lock immediately.",
            text_jp: "å¯¸æ­¢ã‚åœ°ç„ï¼š20åˆ†é–“å‹•ç”»ã‚’è¦‹ã¦ã‚ªãƒŠãƒ‹ãƒ¼ã—ã€ã‚¤ã1ç§’å‰ã«æ­¢ã‚ã¦å³åº§ã«æ–½éŒ ã›ã‚ˆã€‚"
          },

          // Nipples
          { 
            tags: ["nipples"], intensity: "soft",
            text_zh: "æ•æ„Ÿå–šé†’ï¼šä½©æˆ´é–å…·æ™‚ï¼Œç”¨æ‰‹æŒ‡æä½ä¹³é ­è½‰åœˆå„ 100 ä¸‹ã€‚",
            text_en: "Nipple Wake-up: Pinch and rotate nipples 100 times each while locked.",
            text_jp: "ä¹³é¦–é–‹ç™ºï¼šãƒ­ãƒƒã‚¯ä¸­ã€ä¹³é¦–ã‚’æŒ‡ã§ã¤ã¾ã‚“ã§å„100å›å›ã™ã€‚"
          },
          { 
            tags: ["nipples", "pain"], intensity: "medium",
            text_zh: "å¤¾å­åˆ‘ç½°ï¼šä½¿ç”¨å¤¾å­å¤¾ä½ä¹³é ­æŒçºŒ 10 åˆ†é˜ï¼ŒæœŸé–“ä¸å¾—ç™¼å‡ºè²éŸ³ã€‚",
            text_en: "Clamp Punishment: Clamp nipples for 10 mins. Silence required.",
            text_jp: "æ´—æ¿¯ãƒã‚µãƒŸåˆ‘ï¼š10åˆ†é–“ä¹³é¦–ã‚’æ´—æ¿¯ãƒã‚µãƒŸã§æŒŸã‚€ã€‚ãã®é–“ã€å£°ã‚’ä¸Šã’ã¦ã¯ãªã‚‰ãªã„ã€‚"
          },

          // Anal
          { 
            tags: ["anal"], intensity: "medium",
            text_zh: "å¾Œåº­æ„ŸçŸ¥ï¼šåœ¨ç± ä¸­ç‹€æ…‹ä¸‹ï¼Œå˜—è©¦æ”¾å…¥ä¸€æ ¹æ‰‹æŒ‡æˆ–æ˜¯å°å‹å¡å­ï¼Œé©æ‡‰ 10 åˆ†é˜ã€‚",
            text_en: "Anal Sense: Insert a finger or small plug for 10 mins while locked.",
            text_jp: "ã‚¢ãƒŠãƒ«çŸ¥è¦šï¼šãƒ­ãƒƒã‚¯çŠ¶æ…‹ã§æŒ‡ã¾ãŸã¯å°ã•ãªãƒ—ãƒ©ã‚°ã‚’æŒ¿å…¥ã—ã€10åˆ†é–“æ…£ã‚‰ã™ã€‚"
          },
          { 
            tags: ["anal"], intensity: "hard",
            text_zh: "ç•°ç‰©å……ç›ˆï¼šä½©æˆ´ä¸­å‹å¡å­é€²è¡Œæ—¥å¸¸æ´»å‹•ï¼ˆå¦‚åšå®¶äº‹ã€çœ‹æ›¸ï¼‰30 åˆ†é˜ã€‚",
            text_en: "Plugged Life: Wear a medium plug for 30 mins during daily activities.",
            text_jp: "ãƒ—ãƒ©ã‚°ç”Ÿæ´»ï¼šä¸­ã‚µã‚¤ã‚ºã®ãƒ—ãƒ©ã‚°ã‚’è£…ç€ã—ã€å®¶äº‹ã‚„èª­æ›¸ãªã©ã®æ—¥å¸¸æ´»å‹•ã‚’30åˆ†è¡Œã†ã€‚"
          },

          // Pain
          { 
            tags: ["pain", "general"], intensity: "medium",
            text_zh: "é«”èƒ½ç»ç¥­ï¼šå…¨è£¸æ·±è¹² 50 ä¸‹ï¼Œè®“ç± å­æ‹æ‰“ä½ çš„å¤§è…¿å…§å´ã€‚",
            text_en: "Fitness Sacrifice: 50 naked squats. Feel the cage hit your thighs.",
            text_jp: "è‚‰ä½“å¥‰ç´ï¼šå…¨è£¸ã§ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ50å›ã€‚è²æ“å¸¯ãŒå¤ªã‚‚ã‚‚ã‚’æ‰“ã¤ã®ã‚’æ„Ÿã˜ã‚ã€‚"
          },
          { 
            tags: ["pain"], intensity: "hard",
            text_zh: "å½ˆåŠ›æ‡²ç½°ï¼šç”¨æ©¡çš®ç­‹æˆ–å½ˆæ“Šç± èº« 20 ä¸‹ï¼Œæ¯ä¸€è²éƒ½æ˜¯å°æ…¾æœ›çš„å‘Šè§£ã€‚",
            text_en: "Elastic Punishment: Snap a rubber band on the cage 20 times.",
            text_jp: "ã‚´ãƒ ãƒ‘ãƒƒãƒãƒ³åˆ‘ï¼šè¼ªã‚´ãƒ ã§æª»ã‚’20å›å¼¾ãã€‚ãã®éŸ³ã¯æ¬²æœ›ã¸ã®å‘Šè§£ã ã€‚"
          },

          // Humiliation
          { 
            tags: ["humiliation"], intensity: "hard",
            text_zh: "è¦–è¦ºç¾æ¥ï¼šç©¿è‘—èƒ½é€å‡ºé–å½¢ç‹€çš„è¤²å­å»å€’åƒåœ¾æˆ–è¶…å•†è²·æ°´ã€‚",
            text_en: "Visual Shame: Wear pants that show the outline of the cage to a store.",
            text_jp: "è¦–è¦šçš„ç¾æ¥ï¼šè²æ“å¸¯ã®å½¢ãŒé€ã‘ã‚‹ã‚ºãƒœãƒ³ã‚’å±¥ã„ã¦ã‚³ãƒ³ãƒ“ãƒ‹ã«è¡Œãã€‚"
          },
          { 
            tags: ["humiliation", "mind"], intensity: "medium",
            text_zh: "è‡ªæˆ‘è²¶ä½ï¼šåœ¨èº«ä¸Šç”¨å£ç´…å¯«ä¸‹ã€Property (è²¡ç”¢)ã€ï¼Œæ‹ç…§å­˜æª”(ç„¡éœ€ä¸Šå‚³)ã€‚",
            text_en: "Self-Degradation: Write 'Property' on your body with lipstick. Take a photo.",
            text_jp: "è‡ªå·±å‘ä¸‹ï¼šå£ç´…ã§ä½“ã«ã€ŒPropertyï¼ˆæ‰€æœ‰ç‰©ï¼‰ã€ã¨æ›¸ãã€å†™çœŸã‚’æ’®ã‚‹ã€‚"
          },

          // Urethra
          { 
            tags: ["urethra"], intensity: "medium",
            text_zh: "é£²æ°´æ§åˆ¶ï¼šå¤§é‡é£²æ°´å¾Œå¿è€ 45 åˆ†é˜ï¼Œæ„Ÿå—è†€èƒ±èˆ‡é–å…·çš„é›™é‡å£“åŠ›ã€‚",
            text_en: "Water Control: Drink water and hold for 45 mins. Feel the pressure.",
            text_jp: "é£²æ°´ç®¡ç†ï¼šå¤§é‡ã«æ°´ã‚’é£²ã‚“ã å¾Œã€45åˆ†é–“æˆ‘æ…¢ã™ã‚‹ã€‚è†€èƒ±ã¨ãƒ­ãƒƒã‚¯ã®åœ§åŠ›ã‚’æ„Ÿã˜ã‚ã€‚"
          },
          { 
            tags: ["urethra", "general"], intensity: "soft",
            text_zh: "åå§¿æ’æ³„ï¼šå¾ä»Šå¤©èµ·ï¼Œé€™ä¸€å€‹æœˆå…§ä½ åªèƒ½åƒå¥³ç”Ÿä¸€æ¨£åè‘—å°¿å°¿ã€‚",
            text_en: "Sit Down: From today, you must sit down to pee for the whole month.",
            text_jp: "åº§ã‚Šã‚·ãƒ§ãƒ³ï¼šä»Šæ—¥ã‹ã‚‰ä¸€ãƒ¶æœˆé–“ã€å¥³æ€§ã®ã‚ˆã†ã«åº§ã£ã¦ç”¨ã‚’è¶³ã™ã“ã¨ã€‚"
          },

          // Bondage
          { 
            tags: ["bondage"], intensity: "medium",
            text_zh: "ç¹©ç¸›éœåï¼šå°‡é›™æ‰‹åç¶åœ¨èƒŒå¾Œï¼Œè·ªå 20 åˆ†é˜ï¼Œä¸å‡†ç§»å‹•ã€‚",
            text_en: "Rope Meditation: Tie hands behind back, kneel for 20 mins. No moving.",
            text_jp: "ç¸„ç¸›é™åº§ï¼šä¸¡æ‰‹ã‚’å¾Œã‚æ‰‹ã«ç¸›ã‚Šã€20åˆ†é–“æ­£åº§ã™ã‚‹ã€‚å‹•ã„ã¦ã¯ãªã‚‰ãªã„ã€‚"
          },
          { 
            tags: ["bondage"], intensity: "hard",
            text_zh: "å››è‚¢å‰å¥ªï¼šç¡è¦ºæ™‚å¿…é ˆæˆ´ä¸Šçœ¼ç½©ä¸¦ç¨å¾®æŸç¸›é›™æ‰‹ï¼Œé«”é©—ç„¡åŠ©æ„Ÿã€‚",
            text_en: "Limb Deprivation: Sleep with blindfold and lightly bound hands.",
            text_jp: "å››è‚¢å‰¥å¥ªï¼šç›®éš ã—ã‚’ã—ã€ä¸¡æ‰‹ã‚’è»½ãç¸›ã£ã¦çœ ã‚Šã€ç„¡åŠ›æ„Ÿã‚’å‘³ã‚ã†ã€‚"
          },

          // Public
          { 
            tags: ["public"], intensity: "hard",
            text_zh: "é™½å°æ”¾é¢¨ï¼šåœ¨éš±å¯†çš„é™½å°æˆ–çª—é‚Šå…¨è£¸ä½©æˆ´é–å…·ç«™ç«‹ 5 åˆ†é˜ã€‚",
            text_en: "Balcony Air: Stand naked with lock on a secluded balcony for 5 mins.",
            text_jp: "ãƒ™ãƒ©ãƒ³ãƒ€æ”¾ç½®ï¼šäººç›®ã®ãªã„ãƒ™ãƒ©ãƒ³ãƒ€ã‹çª“éš›ã§ã€å…¨è£¸ã§ãƒ­ãƒƒã‚¯ã‚’ç€ã‘ã¦5åˆ†ç«‹ã¤ã€‚"
          },
          { 
            tags: ["public", "humiliation"], intensity: "medium",
            text_zh: "çœŸç©ºæ•£æ­¥ï¼šä¸ç©¿å…§è¤²ï¼Œåªç©¿å¯¬é¬†è¤²å­åœ¨ä½å®¶é™„è¿‘æ•£æ­¥ 10 åˆ†é˜ã€‚",
            text_en: "Commando Walk: No underwear, loose pants. Walk outside for 10 mins.",
            text_jp: "ãƒãƒ¼ãƒ‘ãƒ³æ•£æ­©ï¼šä¸‹ç€ã‚’å±¥ã‹ãšã€ç·©ã„ã‚ºãƒœãƒ³ã ã‘ã§è¿‘æ‰€ã‚’10åˆ†æ•£æ­©ã™ã‚‹ã€‚"
          },

          // Service
          { 
            tags: ["service"], intensity: "soft",
            text_zh: "ç± å…·æ¸…æ½”ï¼šç”¨ç‰™åˆ·ä»”ç´°æ¸…æ½”ç± å…·çš„æ¯ä¸€å€‹ç¸«éš™ï¼Œåƒå°å¾…è–ç‰©ä¸€æ¨£ã€‚",
            text_en: "Cage Cleaning: Clean every gap of the cage with a toothbrush like a holy relic.",
            text_jp: "æª»ã®æ¸…æƒï¼šæ­¯ãƒ–ãƒ©ã‚·ã§æª»ã®éš™é–“ã‚’ä¸å¯§ã«æƒé™¤ã™ã‚‹ã€‚è–éºç‰©ã®ã‚ˆã†ã«æ‰±ã†ã“ã¨ã€‚"
          },
          { 
            tags: ["service"], intensity: "medium",
            text_zh: "è·ªå§¿æ“¦åœ°ï¼šå…¨è£¸ä½©æˆ´é–å…·ï¼Œç”¨æŠ¹å¸ƒè·ªè‘—æ“¦æ‹­å®¶è£¡çš„åœ°æ¿ã€‚",
            text_en: "Kneeling Clean: Clean the floor with a cloth while naked and locked.",
            text_jp: "è†ç«‹ã¡æƒé™¤ï¼šå…¨è£¸ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã§ã€è†ã‚’ã¤ã„ã¦åºŠã‚’é›‘å·¾æ›ã‘ã™ã‚‹ã€‚"
          },

          // Sensory (New)
          { 
            tags: ["sensory"], intensity: "medium",
            text_zh: "é»‘æš—æ™šé¤ï¼šæˆ´ä¸Šçœ¼ç½©é€²é£Ÿæ™šé¤ï¼Œå…¨ç¨‹ä¸å¾—ç™¼å‡ºè²éŸ³ã€‚",
            text_en: "Blind Dinner: Eat dinner while blindfolded. Absolute silence required.",
            text_jp: "æš—é—‡ã®å¤•é£Ÿï¼šç›®éš ã—ã‚’ã—ã¦å¤•é£Ÿã‚’ã¨ã‚‹ã€‚çµ‚å§‹éŸ³ã‚’ç«‹ã¦ã¦ã¯ãªã‚‰ãªã„ã€‚",
            text_kr: "ë¸”ë¼ì¸ë“œ ë””ë„ˆ: ëˆˆê°€ë¦¬ê°œë¥¼ í•˜ê³  ì €ë… ì‹ì‚¬ë¥¼ í•˜ì„¸ìš”. ì ˆëŒ€ ì •ìˆ™."
          },
          { 
            tags: ["sensory", "bondage"], intensity: "hard",
            text_zh: "æ„Ÿå®˜éš”é›¢ï¼šçœ¼ç½©+è€³å¡ï¼Œåœ¨åºŠä¸Šéœèºº 30 åˆ†é˜ï¼Œåªèƒ½æ„Ÿå—ä¸‹é«”çš„æŸç¸›ã€‚",
            text_en: "Sensory Iso: Blindfold + Earplugs. Lie still for 30 mins. Focus only on the lock.",
            text_jp: "æ„Ÿè¦šé®æ–­ï¼šç›®éš ã—ï¼‹è€³æ “ã€‚ãƒ™ãƒƒãƒ‰ã§30åˆ†é–“é™æ­¢ã—ã€ä¸‹åŠèº«ã®æ‹˜æŸã ã‘ã‚’æ„Ÿã˜ã‚‹ã€‚",
            text_kr: "ê°ê° ì°¨ë‹¨: ëˆˆê°€ë¦¬ê°œ + ê·€ë§ˆê°œ. 30ë¶„ ë™ì•ˆ ê°€ë§Œíˆ ëˆ„ì›Œ ìë¬¼ì‡ ì˜ ê°ê°ì—ë§Œ ì§‘ì¤‘í•˜ì„¸ìš”."
          }
        ];

        // --- Themes Configuration ---
        const THEMES = {
          classic: { 
            id: 'classic', 
            name: 'ç¶“å…¸æ·é– (Classic)', 
            colors: {
              bg: 'bg-stone-950', text: 'text-stone-200', border: 'border-stone-800',
              accent: 'text-red-600', accentBg: 'bg-red-900', card: 'bg-stone-900',
              cardHover: 'hover:border-stone-600', modal: 'bg-stone-900 border-red-900', button: 'bg-red-800 hover:bg-red-700'
            }
          },
          cyber: { 
            id: 'cyber', 
            name: 'è³½åšç›£ç¦ (Cyber)', 
            colors: {
              bg: 'bg-black', text: 'text-cyan-50', border: 'border-cyan-900',
              accent: 'text-fuchsia-500', accentBg: 'bg-fuchsia-900', card: 'bg-slate-900',
              cardHover: 'hover:border-fuchsia-500 hover:shadow-[0_0_15px_rgba(217,70,239,0.3)]',
              modal: 'bg-black border-fuchsia-600', button: 'bg-fuchsia-700 hover:bg-fuchsia-600'
            }
          },
          industrial: { 
            id: 'industrial', 
            name: 'é‡å·¥æ¥­ (Industrial)', 
            colors: {
              bg: 'bg-neutral-900', text: 'text-orange-100', border: 'border-orange-900/50',
              accent: 'text-orange-500', accentBg: 'bg-orange-900', card: 'bg-neutral-800',
              cardHover: 'hover:border-orange-500', modal: 'bg-neutral-800 border-orange-600', button: 'bg-orange-700 hover:bg-orange-600'
            }
          },
          clinical: { 
            id: 'clinical', 
            name: 'è‡¨åºŠå¯¦é©— (Clinical)', 
            colors: {
              bg: 'bg-slate-50', text: 'text-slate-700', border: 'border-slate-300',
              accent: 'text-rose-600', accentBg: 'bg-rose-200', card: 'bg-white shadow-sm',
              cardHover: 'hover:border-rose-400 hover:shadow-md', modal: 'bg-white border-rose-500', button: 'bg-slate-800 hover:bg-slate-700'
            }
          },
          royal: { 
            id: 'royal', 
            name: 'çš‡å®¤èª¿æ•™ (Royal)', 
            colors: {
              bg: 'bg-slate-900', text: 'text-slate-200', border: 'border-yellow-900/30',
              accent: 'text-yellow-500', accentBg: 'bg-yellow-900/40', card: 'bg-slate-800',
              cardHover: 'hover:border-yellow-500/50', modal: 'bg-slate-800 border-yellow-600', button: 'bg-indigo-900 hover:bg-indigo-800'
            }
          },
        };

        const LockCalendarPro = () => {
          const [verified, setVerified] = useState(false);
          const [step, setStep] = useState(0); 
          const [selectedDay, setSelectedDay] = useState(null); 
          const exportRef = useRef(null); 
          const [libLoaded, setLibLoaded] = useState(false);
          const [lang, setLang] = useState('zh-TW');

          useEffect(() => {
            // html2canvas is loaded via script tag in head, just checking presence
            if(window.html2canvas) setLibLoaded(true);
          }, []);

          const now = new Date();
          const currentYear = now.getFullYear();
          const currentMonth = now.getMonth() + 1; 

          const [userData, setUserData] = useState({
            name: '', level: 'medium', year: currentYear, month: currentMonth, theme: 'classic',
            prefs: {
              nipples: 1, anal: 1, urethra: 1, pain: 1, humiliation: 1, edging: 1,
              bondage: 1, public: 1, service: 1, sensory: 1
            }
          });

          const [calendar, setCalendar] = useState([]);

          // --- Helpers ---
          const currentTheme = THEMES[userData.theme].colors;
          const t = TRANSLATIONS[lang]; 

          const handlePrefChange = (key, val) => setUserData(prev => ({ ...prev, prefs: { ...prev.prefs, [key]: val } }));

          const getTaskIcon = (tags, type) => {
            const props = { className: `w-full h-full opacity-20 ${currentTheme.text}` };
            if (type === 'start' || type === 'end') return <Lock {...props} className={`w-full h-full opacity-20 ${currentTheme.accent}`} />;
            if (type === 'check') return <ShieldAlert {...props} />;
            
            if (tags.includes('nipples')) return <Disc {...props} />;
            if (tags.includes('anal')) return <Activity {...props} />;
            if (tags.includes('urethra')) return <Droplet {...props} />;
            if (tags.includes('pain')) return <Zap {...props} />;
            if (tags.includes('humiliation')) return <Eye {...props} />;
            if (tags.includes('edging')) return <Flame {...props} />;
            if (tags.includes('mind')) return <Ghost {...props} />;
            if (tags.includes('bondage')) return <Anchor {...props} />;
            if (tags.includes('public')) return <Globe {...props} />;
            if (tags.includes('service')) return <Ruler {...props} />;
            if (tags.includes('sensory')) return <Headphones {...props} />;
            
            return <Smile {...props} />;
          };

          const getTaskText = (taskObj) => {
             // Explicit fallbacks to ensure text exists
             if (lang === 'en') return taskObj.text_en || taskObj.text_zh;
             if (lang === 'jp') return taskObj.text_jp || taskObj.text_zh;
             if (lang === 'kr') return taskObj.text_kr || taskObj.text_en || taskObj.text_zh;
             if (lang === 'de') return taskObj.text_en || taskObj.text_zh; // Fallback to EN for new langs
             if (lang === 'es') return taskObj.text_en || taskObj.text_zh; // Fallback to EN
             if (lang === 'fr') return taskObj.text_en || taskObj.text_zh; // Fallback to EN
             if (lang === 'ru') return taskObj.text_en || taskObj.text_zh; // Fallback to EN
             return taskObj.text_zh;
          };

          // --- Logic: Unique Task Generation ---
          const generateProtocol = () => {
            const daysInMonth = new Date(userData.year, userData.month, 0).getDate();
            let firstDayIndex = new Date(userData.year, userData.month - 1, 1).getDay(); 
            let offset = firstDayIndex === 0 ? 6 : firstDayIndex - 1;

            // 1. Create a large weighted pool
            let weightedPool = [];
            // General tasks are always included
            const baseTasks = TASKS_DB.filter(t => t.tags.includes('general'));
            weightedPool.push(...baseTasks); 

            // Add tasks based on prefs
            Object.entries(userData.prefs).forEach(([key, rating]) => {
              if (rating > 1) {
                const tagTasks = TASKS_DB.filter(t => t.tags.includes(key));
                // Add multiple copies to increase probability in the shuffle
                const multiplier = rating; 
                for (let i = 0; i < multiplier; i++) {
                  weightedPool.push(...tagTasks);
                }
              }
            });

            // Filter by intensity
            weightedPool = weightedPool.filter(task => {
              if (userData.level === 'soft') return task.intensity === 'soft';
              if (userData.level === 'medium') return task.intensity !== 'hard';
              return true;
            });

            // Fallback if pool is too small
            if (weightedPool.length < 5) weightedPool = TASKS_DB.filter(t => t.tags.includes('general'));

            // 2. Shuffle the weighted pool completely
            const shuffledPool = [...weightedPool].sort(() => Math.random() - 0.5);

            // 3. Select unique tasks
            const selectedTasks = [];
            const usedTexts = new Set();
            
            for (const task of shuffledPool) {
              // Use text_zh as unique ID for simplicity since it always exists
              if (!usedTexts.has(task.text_zh)) {
                selectedTasks.push(task);
                usedTexts.add(task.text_zh);
              }
              if (selectedTasks.length >= daysInMonth) break;
            }

            // If we still don't have enough unique tasks (rare case), fill with randoms
            while (selectedTasks.length < daysInMonth) {
               selectedTasks.push(shuffledPool[Math.floor(Math.random() * shuffledPool.length)]);
            }

            // 4. Build Days (No fixed start/end tasks)
            const days = [];
            for (let k = 0; k < offset; k++) {
              days.push({ day: null, type: 'empty' });
            }

            // Shuffle selected unique tasks again to distribute intensity
            const finalTaskOrder = selectedTasks.sort(() => Math.random() - 0.5);

            for (let i = 1; i <= daysInMonth; i++) {
              let taskObj = finalTaskOrder[i - 1]; // Use index
              let type = "normal";
              
              // Optional: Mark special days visually but keep random tasks
              if (i === 1) type = "start";
              else if (i === daysInMonth) type = "end";
              else if (i % 7 === 0) type = "check";

              days.push({ 
                day: i, 
                task: getTaskText(taskObj), 
                tags: taskObj.tags || ['general'], 
                type 
              });
            }
            setCalendar(days);
            setStep(2);
          };

          const downloadImage = async () => {
            if (!exportRef.current || !window.html2canvas) { alert("Loading..."); return; }
            try {
              const canvas = await window.html2canvas(exportRef.current, {
                scale: 2, backgroundColor: userData.theme === 'clinical' ? '#f8fafc' : '#0c0a09',
                useCORS: true, logging: false
              });
              const link = document.createElement('a');
              link.download = `LockCalendar_${userData.year}_${userData.month}.png`;
              link.href = canvas.toDataURL();
              link.click();
            } catch (err) { console.error(err); alert("Failed."); }
          };

          if (!verified) {
            return (
              <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-95 text-red-600 font-sans">
                <div className="bg-stone-900 border-2 border-red-800 p-8 rounded-lg max-w-md text-center shadow-[0_0_30px_rgba(220,38,38,0.3)]">
                  <div className="text-6xl mb-6 animate-pulse">ğŸ”</div>
                  <h1 className="text-3xl font-bold mb-4 tracking-widest uppercase">{t.warn_title}</h1>
                  <div className="text-stone-400 text-sm text-left mb-6 space-y-2 border-t border-b border-stone-700 py-4">
                    <p>{t.warn_text1}</p>
                    <p>{t.warn_text2}</p>
                  </div>
                  <div className="flex gap-4 justify-center">
                    <button onClick={() => window.location.href = 'https://www.google.com'} className="px-6 py-2 border border-stone-600 text-stone-400 hover:bg-stone-800 rounded transition-colors">{t.warn_leave}</button>
                    <button onClick={() => setVerified(true)} className="px-6 py-2 bg-red-900 text-white font-bold rounded hover:bg-red-700 hover:shadow-[0_0_15px_rgba(220,38,38,0.5)] transition-all">{t.warn_enter}</button>
                  </div>
                </div>
              </div>
            );
          }

          const RatingControl = ({ label, value, onChange, icon }) => (
            <div className={`${currentTheme.card} ${currentTheme.border} border p-4 rounded-lg flex flex-col gap-3 transition-colors`}>
              <div className={`flex items-center gap-2 font-bold ${currentTheme.text} opacity-90 text-sm md:text-base`}>
                {icon} {label}
              </div>
              <div className="flex justify-between items-center bg-black/20 rounded p-1">
                {[1, 2, 3, 4, 5].map(num => (
                  <button key={num} onClick={() => onChange(num)}
                    className={`w-8 h-8 rounded text-sm font-bold transition-all ${value === num ? `${currentTheme.button} text-white shadow-lg` : `${currentTheme.text} opacity-50 hover:opacity-100 hover:bg-white/10`}`}>
                    {num}
                  </button>
                ))}
              </div>
            </div>
          );

          return (
            <div className={`min-h-screen ${currentTheme.bg} ${currentTheme.text} font-sans pb-20 overflow-x-hidden transition-colors duration-500`}>
              <header className={`backdrop-blur-md sticky top-0 z-40 border-b ${currentTheme.border} p-4 bg-black/20`}>
                <div className="max-w-4xl mx-auto flex justify-between items-center">
                  <div className={`flex items-center gap-2 ${currentTheme.accent}`}>
                    <Lock className="w-6 h-6" />
                    <span className={`font-black tracking-widest text-lg ${currentTheme.text}`}>{t.title} <span className="text-xs font-normal opacity-70">{t.subtitle}</span></span>
                  </div>
                  <div className="flex items-center gap-4">
                     <select value={lang} onChange={(e) => setLang(e.target.value)} className={`bg-transparent border ${currentTheme.border} text-xs p-1 rounded ${currentTheme.text} opacity-70 hover:opacity-100 focus:outline-none`}>
                       <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                       <option value="en">English</option>
                       <option value="jp">æ—¥æœ¬èª</option>
                       <option value="kr">í•œêµ­ì–´</option>
                       <option value="de">Deutsch</option>
                       <option value="fr">FranÃ§ais</option>
                       <option value="es">EspaÃ±ol</option>
                       <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                     </select>
                     <div className="text-xs opacity-50 font-mono hidden sm:block">{t.version}</div>
                  </div>
                </div>
              </header>

              <main className="max-w-4xl mx-auto p-4 mt-8">
                {step === 0 && (
                  <div className="max-w-2xl mx-auto text-center space-y-8 animate-fade-in">
                    <div className={`w-24 h-24 rounded-full mx-auto flex items-center justify-center border-2 shadow-[0_0_30px_rgba(0,0,0,0.2)] ${currentTheme.card} ${currentTheme.border}`}>
                      <Key className={`w-10 h-10 ${currentTheme.accent}`} />
                    </div>
                    <div className="space-y-4"><h2 className="text-3xl font-bold">{t.intro_title}</h2><p className="opacity-70 leading-relaxed text-lg">{t.intro_desc(currentTheme.accent)}</p></div>
                    <button onClick={() => setStep(1)} className={`group relative px-8 py-4 ${currentTheme.card} font-bold tracking-widest overflow-hidden rounded border ${currentTheme.border} hover:border-current transition-all`}>
                      <span className={`relative z-10 flex items-center gap-2 ${currentTheme.accent}`}>{t.btn_start} <ChevronRight className="w-4 h-4 group-hover:translate-x-1 transition-transform"/></span>
                    </button>
                  </div>
                )}

                {step === 1 && (
                  <div className="max-w-2xl mx-auto space-y-6 animate-slide-up">
                    <div className={`${currentTheme.card} border ${currentTheme.border} p-6 rounded-lg`}>
                      <h3 className="text-xl font-bold mb-4 flex items-center gap-2"><Lock className="w-4 h-4"/> {t.step1_title}</h3>
                      <div className="space-y-4">
                        <div><label className="text-xs opacity-60 mb-1 block">{t.label_name}</label><input type="text" value={userData.name} onChange={e => setUserData({...userData, name: e.target.value})} className={`w-full bg-black/20 border ${currentTheme.border} rounded p-3 focus:outline-none focus:border-current`} placeholder="..." /></div>
                        <div><label className="text-xs opacity-60 mb-2 block">{t.label_level}</label><div className="grid grid-cols-3 gap-2">{['soft', 'medium', 'hard'].map(l => (<button key={l} onClick={() => setUserData({...userData, level: l})} className={`py-2 rounded border text-sm uppercase font-bold transition-all ${userData.level === l ? `${currentTheme.button} text-white border-transparent` : `bg-transparent ${currentTheme.border} opacity-60`}`}>{l}</button>))}</div></div>
                      </div>
                    </div>

                    <div className={`${currentTheme.card} border ${currentTheme.border} p-6 rounded-lg`}>
                       <h3 className="text-xl font-bold mb-4 flex items-center gap-2"><Calendar className="w-4 h-4"/> {t.label_date}</h3>
                       <div className="grid grid-cols-2 gap-4">
                         <div><label className="text-xs opacity-60 mb-1 block">{t.label_year}</label><input type="number" value={userData.year} onChange={e => setUserData({...userData, year: parseInt(e.target.value)})} className={`w-full bg-black/20 border ${currentTheme.border} rounded p-3 focus:outline-none focus:border-current`} /></div>
                         <div><label className="text-xs opacity-60 mb-1 block">{t.label_month}</label><input type="number" min="1" max="12" value={userData.month} onChange={e => setUserData({...userData, month: parseInt(e.target.value)})} className={`w-full bg-black/20 border ${currentTheme.border} rounded p-3 focus:outline-none focus:border-current`} /></div>
                       </div>
                    </div>

                    <div>
                       <h3 className="text-xl font-bold mb-4 flex items-center gap-2"><Activity className="w-4 h-4"/> {t.step1_ratings_title}</h3>
                       <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                         <RatingControl label={t.label_nipples} icon={<Disc className="w-4 h-4"/>} value={userData.prefs.nipples} onChange={v => handlePrefChange('nipples', v)} />
                         <RatingControl label={t.label_anal} icon={<Eye className="w-4 h-4"/>} value={userData.prefs.anal} onChange={v => handlePrefChange('anal', v)} />
                         <RatingControl label={t.label_urethra} icon={<Droplet className="w-4 h-4"/>} value={userData.prefs.urethra} onChange={v => handlePrefChange('urethra', v)} />
                         <RatingControl label={t.label_pain} icon={<Zap className="w-4 h-4"/>} value={userData.prefs.pain} onChange={v => handlePrefChange('pain', v)} />
                         <RatingControl label={t.label_humiliation} icon={<Ghost className="w-4 h-4"/>} value={userData.prefs.humiliation} onChange={v => handlePrefChange('humiliation', v)} />
                         <RatingControl label={t.label_edging} icon={<Flame className="w-4 h-4"/>} value={userData.prefs.edging} onChange={v => handlePrefChange('edging', v)} />
                         <RatingControl label={t.label_bondage} icon={<Anchor className="w-4 h-4"/>} value={userData.prefs.bondage} onChange={v => handlePrefChange('bondage', v)} />
                         <RatingControl label={t.label_public} icon={<Globe className="w-4 h-4"/>} value={userData.prefs.public} onChange={v => handlePrefChange('public', v)} />
                         <RatingControl label={t.label_service} icon={<Ruler className="w-4 h-4"/>} value={userData.prefs.service} onChange={v => handlePrefChange('service', v)} />
                         <RatingControl label={t.label_sensory} icon={<Headphones className="w-4 h-4"/>} value={userData.prefs.sensory} onChange={v => handlePrefChange('sensory', v)} />
                       </div>
                    </div>

                    <div className={`${currentTheme.card} border ${currentTheme.border} p-6 rounded-lg`}>
                      <h3 className="text-xl font-bold mb-4 flex items-center gap-2"><Palette className="w-4 h-4"/> {t.step1_theme_title}</h3>
                      <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        {Object.values(THEMES).map(th => (
                          <button key={th.id} onClick={() => setUserData({...userData, theme: th.id})} className={`p-3 rounded border text-left flex items-center gap-3 transition-all ${userData.theme === th.id ? `${currentTheme.border} ring-1 ring-offset-2 ring-offset-transparent ring-current` : 'border-transparent opacity-50 hover:opacity-100'}`} style={{ backgroundColor: th.id === 'clinical' ? '#f1f5f9' : '#1c1917' }} >
                            <div className={`w-4 h-4 rounded-full ${th.colors.accentBg}`}></div><span className={th.id === 'clinical' ? 'text-slate-800' : 'text-white'}>{th.name}</span>
                          </button>
                        ))}
                      </div>
                    </div>

                    <button onClick={generateProtocol} disabled={!userData.name} className={`w-full py-4 ${currentTheme.button} text-white font-bold rounded shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex justify-center items-center gap-2 mt-4`}>{t.btn_generate} <ChevronRight className="w-4 h-4"/></button>
                  </div>
                )}

                {step === 2 && (
                  <div className="animate-slide-up relative">
                    <div className={`flex flex-col md:flex-row justify-between items-end mb-6 border-b ${currentTheme.border} pb-4 gap-4`}>
                      <div><h2 className="text-3xl font-black uppercase">{userData.name} {t.step2_title}</h2><div className="flex gap-4 text-sm opacity-60 mt-1 font-mono"><span>{userData.year} / {userData.month}</span><span>Lv: {userData.level.toUpperCase()}</span></div></div>
                      <div className="flex gap-2">
                         <button onClick={() => setStep(1)} className={`p-2 border ${currentTheme.border} opacity-60 hover:opacity-100 rounded`}><RefreshCcw className="w-4 h-4" /></button>
                         <button onClick={downloadImage} disabled={!libLoaded} className={`px-4 py-2 ${currentTheme.card} border ${currentTheme.border} font-bold rounded flex items-center gap-2 text-sm hover:brightness-110 transition-all disabled:opacity-50`}><Download className="w-4 h-4" /> {t.btn_download}</button>
                      </div>
                    </div>

                    <div className="grid grid-cols-7 gap-1 md:gap-3">
                      {['MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT', 'SUN'].map(d => (<div key={d} className="text-center text-xs opacity-40 font-mono py-2">{d}</div>))}
                      {calendar.map((day, idx) => (
                        day.type === 'empty' ? (<div key={`empty-${idx}`} className="hidden md:block"></div>) : (
                          <div key={day.day} onClick={() => setSelectedDay(day)} className={`relative p-2 md:p-3 rounded border transition-all cursor-pointer group flex flex-col min-h-[120px] ${currentTheme.card} ${currentTheme.border} ${currentTheme.cardHover}`}>
                            <div className="absolute -right-4 -bottom-4 w-24 h-24 transform rotate-12 opacity-5 pointer-events-none">{getTaskIcon(day.tags, day.type)}</div>
                            <div className="flex justify-between items-start z-10 mb-2">
                              <span className={`text-lg md:text-xl font-black font-mono ${day.type === 'start' || day.type === 'end' ? currentTheme.accent : 'opacity-40 group-hover:opacity-80'}`}>{String(day.day).padStart(2, '0')}</span>
                              {day.type === 'start' && <Lock className={`w-4 h-4 ${currentTheme.accent}`} />}
                              {day.type === 'end' && <Key className={`w-4 h-4 ${currentTheme.accent}`} />}
                              {day.type === 'check' && <ShieldAlert className="w-4 h-4 text-yellow-600" />}
                            </div>
                            <p className="text-[11px] md:text-xs opacity-70 leading-relaxed z-10 break-words whitespace-normal">{day.task}</p>
                          </div>
                        )
                      ))}
                    </div>

                    {selectedDay && selectedDay.type !== 'empty' && (
                      <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4" onClick={() => setSelectedDay(null)}>
                        <div className={`${currentTheme.modal} border-2 p-6 rounded-lg max-w-sm w-full shadow-2xl relative ${currentTheme.bg}`} onClick={e => e.stopPropagation()}>
                          <button onClick={() => setSelectedDay(null)} className="absolute top-3 right-3 opacity-50 hover:opacity-100"><X className="w-5 h-5"/></button>
                          <div className="flex justify-center mb-6"><div className={`w-20 h-20 rounded-full bg-black/20 flex items-center justify-center p-4 ${currentTheme.border} border`}>{getTaskIcon(selectedDay.tags, selectedDay.type)}</div></div>
                          <h3 className={`${currentTheme.accent} font-mono text-lg font-bold mb-4 border-b ${currentTheme.border} pb-2 text-center`}>{userData.year}.{userData.month}.{String(selectedDay.day).padStart(2,'0')}</h3>
                          <p className={`text-lg leading-relaxed font-medium ${currentTheme.text} text-center`}>{selectedDay.task}</p>
                        </div>
                      </div>
                    )}
                  </div>
                )}
              </main>

              <div className="absolute top-0 left-[-9999px]">
                  <div ref={exportRef} className={`w-[1920px] h-[1080px] ${currentTheme.bg} ${currentTheme.text} px-16 py-12 flex flex-col justify-between border-[20px] ${currentTheme.border} relative`}>
                    <div className="absolute inset-0 opacity-10" style={{backgroundImage: `radial-gradient(circle at 50% 50%, currentColor 0%, transparent 50%)`}}></div>
                    <div className={`flex justify-between items-start border-b-4 ${currentTheme.border} pb-6 z-10`}>
                      <div><h1 className="text-6xl font-black tracking-[0.2em] mb-4">{t.title}</h1><div className="flex gap-8 text-2xl opacity-60 font-mono"><span>SUBJECT: <span className="font-bold opacity-100">{userData.name}</span></span><span>DATE: {userData.year} / {userData.month}</span></div></div>
                      <div className="text-right"><Lock className={`w-20 h-20 ${currentTheme.accent} mb-2`} /><div className="text-xl font-mono opacity-50">{t.subtitle}</div></div>
                    </div>
                    <div className="grid grid-cols-7 gap-4 mb-2 mt-4 px-2 opacity-50 font-mono text-lg z-10">{['MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT', 'SUN'].map(d => <div key={d} className="text-center">{d}</div>)}</div>
                    <div className="grid grid-cols-7 gap-4 flex-grow px-2 z-10 content-start">
                      {calendar.map((day, idx) => (
                        day.type === 'empty' ? (<div key={`exp-empty-${idx}`} className="border-transparent"></div>) : (
                          <div key={day.day} className={`border ${currentTheme.border} p-3 relative flex flex-col h-full overflow-hidden ${day.type === 'start' || day.type === 'end' ? 'bg-black/10' : ''}`}>
                            <div className="absolute -right-2 -bottom-2 w-16 h-16 transform rotate-12 opacity-[0.07]">{getTaskIcon(day.tags, day.type)}</div>
                            <span className={`text-xl font-bold font-mono mb-1 ${day.type === 'check' ? 'text-yellow-500' : 'opacity-40'}`}>{day.day}</span>
                            <p className="text-[11px] leading-tight opacity-90 relative z-10 whitespace-normal break-words font-medium">{day.task}</p>
                          </div>
                        )
                      ))}
                    </div>
                    <div className={`flex justify-between items-end border-t ${currentTheme.border} pt-6 z-10`}>
                      <div className="opacity-50 font-mono text-lg w-1/2 whitespace-pre-wrap">{t.footer_sign}</div>
                      <div className="text-right"><div className="text-4xl font-black opacity-80">{t.footer_approve}</div></div>
                    </div>
                  </div>
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<LockCalendarPro />);
    </script>
</body>
</html>
